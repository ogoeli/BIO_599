library(tidyverse)
# Load data
Owls <- read.csv("Owls.csv")  # Create variables used in the analysis
Owls$NCalls     <- Owls$SiblingNegotiation
Owls$LBroodSize <- log(Owls$BroodSize)
Owls$NestNight  <- factor(ifelse(Owls$FoodTreatment == "Deprived",                                  paste(Owls$Nest, ".Dep", sep=""),                                  paste(Owls$Nest, ".Sat", sep="")))
# Scatter plot: NCalls vs ArrivalTime
ggplot(Owls, aes(x = ArrivalTime, y = NCalls)) +
geom_point(alpha = 0.6) +
geom_smooth(method = "loess", se = FALSE, color = "blue") +
labs(title = "Number of Calls vs Arrival Time",
x = "Arrival Time (hours)",
y = "Number of Calls") +
theme_minimal()
# Box + violin plot: NCalls by FoodTreatment
ggplot(Owls, aes(x = FoodTreatment, y = NCalls, fill = FoodTreatment)) +
geom_violin(alpha = 0.4) +
geom_boxplot(width = 0.1, outlier.color = "red", outlier.shape = 16) +
labs(title = "Number of Calls by Food Treatment",
x = "Food Treatment",
y = "Number of Calls") +
theme_minimal() +
scale_fill_brewer(palette = "Set2")
# Fit Poisson GLM
glm_poisson <- glm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls)
# Summary of model
summary(glm_poisson)
# Fit Quasi-Poisson GLM
glm_qp <- glm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = quasipoisson(link = "log"),
data = Owls)
summary(glm_qp)
library(tidyverse)
library(geepack)
# Fit GEE model
gee_model <- geeglm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls,
id = Nest,                # cluster by Nest
corstr = "exchangeable")  # assumes constant correlation within clusters
summary(gee_model)
# Fit GEE with AR(1) correlation
gee_ar1 <- geeglm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls,
id = NestNight,    # cluster = NestNight
corstr = "ar1")    # AR(1) correlation
library(tidyverse)
library(geepack)
library(sjPlot)
# Fit GEE with AR(1) correlation
gee_ar1 <- geeglm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls,
id = NestNight,    # cluster = NestNight
corstr = "ar1")    # AR(1) correlation
tab_model(gee_ar1, gee_model)
QIC(gee_ar1)
QIC(gee_model)
# Starting AR(1) model (already fit)
gee_Anova <- geeglm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls,
id = NestNight,
corstr = "ar1")
# Test interactions using Wald-type F-tests
anova(gee_Anova, test = "Wald")
anova(gee_Anova)
# Starting AR(1) model (already fit)
gee_Anova <- geeglm(NCalls ~ SexParent * FoodTreatment + SexParent * ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls,
id = NestNight,
corstr = "ar1")
# Test interactions using Wald-type F-tests
anova(gee_Anova, test = "Wald")
anova(gee_Anova)
##final model with intercation removed
gee_final <- geeglm(NCalls ~FoodTreatment + ArrivalTime + offset(LBroodSize),
family = poisson(link = "log"),
data = Owls,
id = NestNight,
corstr = "ar1")
# Test interactions using Wald-type F-tests
anova(gee_final, test = "Wald")
anova(gee_final)
exp(coef(gee_final))
tab_model(gee_final)
plot(ggpredict(gee_final), show_data=TRUE)
library(tidyverse)
library(geepack)
library(sjPlot)
library(ggpredict)
library(tidyverse)
library(geepack)
library(sjPlot)
library(ggeffects)
exp(coef(gee_final))
tab_model(gee_final)
plot(ggpredict(gee_final), show_data=TRUE)
poisfit <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParentFoodTreatment + SexParentArrivalTime + (1|NestNight),
family = Poisson
data = Owls
poisfit <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParentFoodTreatment + SexParentArrivalTime + (1|NestNight),
family = Poisson,
data = Owls
)
exp(coef(gee_final))
tab_model(gee_final)
plot(ggpredict(gee_final), show_data=TRUE)
effect_of_ <- (0.561−1)×100
exp(coef(gee_final))
tab_model(gee_final)
plot(ggpredict(gee_final), show_data=TRUE)
effect_of_FoodTreatment <- (0.56−1)×100
library(tidyverse)
library(geepack)
library(sjPlot)
library(ggeffects)
library(glmmTMB)
poisfit <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParentFoodTreatment + SexParentArrivalTime + (1|NestNight),
family = Poisson,
data = Owls
)
poisfit <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParentFoodTreatment + SexParentArrivalTime + (1|NestNight),
family = poisson,
data = Owls
)
poisfit <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParent*FoodTreatment + SexParent*ArrivalTime + (1|NestNight),
family = poisson,
data = Owls
)
summary(poisfit)
nbfit1 <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParent*FoodTreatment + SexParent*ArrivalTime + (1|NestNight),
family = nbinom2,
data = Owls
)
summary(nbfit1)
tab_model(nbfit1)
set.seed(1)
res_pois <- simulateResiduals(nbfit1)
library(tidyverse)
library(geepack)
library(sjPlot)
library(ggeffects)
library(glmmTMB)
library(DHARMa)
library(tidyverse)
library(geepack)
library(sjPlot)
library(ggeffects)
library(glmmTMB)
library(DHARMa)
library(lmtest)
testZeroInflation(res_nbfit1)
nbfit1 <- glmmTMB(
NCalls ~ offset(LBroodSize) + SexParent*FoodTreatment + SexParent*ArrivalTime + (1|NestNight),
family = nbinom2,
data = Owls
)
summary(nbfit1)
tab_model(nbfit1)
set.seed(1)
res_nbfit1 <- simulateResiduals(nbfit1)
plot(res_nbfit1)
AIC(nbfit1, poisfit)
testZeroInflation(res_nbfit1)
# Zero-inflated NB model with constant zero-inflation
zinb_model <- glmmTMB(NCalls ~ offset(LBroodSize) + SexParent*FoodTreatment + SexParent*ArrivalTime + (1|NestNight),
ziformula = ~ 1,    # constant zero-inflation
family = nbinom2,
data = Owls)
summary(zinb_model)
testZeroInflation(res_nbfit1)
# Zero-inflated NB model with constant zero-inflation
zinb_model <- glmmTMB(NCalls ~ offset(LBroodSize) + SexParent*FoodTreatment + SexParent*ArrivalTime + (1|NestNight),
ziformula = ~ 1,    # constant zero-inflation
family = nbinom2,
data = Owls)
summary(zinb_model)
AIC(nbfit1, poisfit, zinb_model)
drop1(zinb_model)
drop1(zinb_model,test = "Chi")
drop1(zinb_model,test = "Chi")
zinb_reduced <- glmmTMB(NCalls ~ offset(LBroodSize) + SexParent + FoodTreatment + ArrivalTime +
(1 | NestNight),
ziformula = ~1,
family = nbinom2,
data = Owls)
summary(zinb_reduced)
coef_exp <- exp(fixef(zinb_final)$cond)
coef_exp <- exp(fixef(zinb_reduced)$cond)
coef_exp

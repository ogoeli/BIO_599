library(tidyverse)
library(tidyverse)
library(nlme)
library(tidyverse)
library(nlme)
library(lme4)
data <- read.csv("Irishforest.csv")
str(data)
ggplot(data, aes(x = Forested, y = pH)) +
geom_point() +
geom_line() +
scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
ggplot(irish, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
ggplot(data, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
ggplot(data, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
//scale_color_gradient(low = "orange", high = "blue") +
ggplot(data, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
#scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
ggplot(data, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
#scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
data$Forested <- factor(data$Forested)
ggplot(data, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
#scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
data$Forested <- factor(data$Forested)
ggplot(data, aes(x = Easting, y = Northing)) +
geom_point(aes(color = pH, shape = Forested), size = 3) +
#scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "PH Vs Forested at different locations")
ph_gls <- gls(pH ~ SDI*Forested*Altitude, data = data, method = "ML")
tab_model(ph_gls, show.aic = TRUE, show.se = TRUE)
library(tidyverse)
library(nlme)
library(lme4)
library(sjPlot)
ph_gls <- gls(pH ~ SDI*Forested*Altitude, data = data, method = "ML")
tab_model(ph_gls, show.aic = TRUE, show.se = TRUE)
data$resid <- residuals(ph_gls, type = "normalized")
ggplot(data, aes(x = Easting, y = Northing, color = resid, size = abs(resid))) +
geom_point() +
scale_color_gradient2() +
theme_bw()
ggplot(data, aes(x = Easting, y = Northing, color = resid, size = abs(resid))) +
geom_point() +
scale_color_gradient2() +
theme_bw()
ggplot(data, aes(x = Easting, y = Northing, color = resid, size = abs(resid))) +
geom_point() +
scale_color_gradient2() +
theme_bw()
data$resid <- residuals(ph_gls, type = "normalized")
plot(data$resid)
data$resid <- residuals(ph_gls, type = "normalized")
plot(data$resid)
plot(ph_gls)
#The nlme package includes a built-in Variogram() function to plot these.
vario_bor <- Variogram(ph_gls, form = ~ Easting + Northing, resType = "normalized")
plot(vario_bor)
#The nlme package includes a built-in Variogram() function to plot these.
vario_bor <- Variogram(ph_gls, form = ~ Easting + Northing, resType = "normalized")
plot(vario_bor)
#Exponential type of spatial correlation
ph_exp <- update(ph_gls,
correlation = corExp(form = ~ Easting + Northing, nugget = TRUE))
#Exponential type of spatial correlation
ph_exp <- update(ph_gls,
correlation = corExp(form = ~ Easting + Northing, nugget = TRUE))
#Gaussian
ph_gaus <- update(ph_gls,
correlation = corGaus(form = ~ Easting + Northing, nugget = TRUE))
#Linear
ph_lin <- update(ph_gls,
correlation = corLin(form = ~ Easting + Northing, nugget = TRUE))
#Ratio
ph_ratio <- update(ph_gls,
correlation = corRatio(form = ~ Easting + Northing, nugget = TRUE))
#Spherical
ph_spher <- update(ph_gls,
correlation = corSpher(form = ~ Easting + Northing, nugget = TRUE))
AIC(ph_gls, ph_exp, ph_gaus, ph_ratio, ph_spher, ph_lin)
AIC(ph_gls, ph_exp, ph_gaus, ph_ratio, ph_spher, ph_lin)
vario_best <- Variogram(ph_ratio, form = ~ Easting+ Northing, resType = "normalized")
plot(vario_best)
data_2 <- read.csv("Cod_daily_depth_data.csv")
str(data_2)
data$date <- dmy(data$date)
data_2$date <- dmy(data_2$date)
data_2$log_depth_mean_day <- log(data_2$depth_mean_day)
ggplot(data_2, aes(x = log_depth_mean_day, y = Temperature_1m, color = fish)) +
geom_point() +
geom_line() +
scale_color_gradient(low = "orange", high = "blue") +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
data_2$log_depth_mean_day <- log(data_2$depth_mean_day)
ggplot(data_2, aes(x = log_depth_mean_day, y = Temperature_1m, color = fish)) +
geom_point() +
geom_line() +
theme_bw() +
labs(title = "Moorhen abundance on Kauai")
data_2$log_depth_mean_day <- log(data_2$depth_mean_day)
ggplot(data_2, aes(x = log_depth_mean_day, y = Temperature_1m, color = fish)) +
geom_point() +
geom_line() +
theme_bw() +
labs(title = "Fish abundance by depth and Temperature")
data$Temperature_z <- scale(data$Temperature_1m, center = TRUE, scale = FALSE)
data$Temperature_z <- scale(data_2$Temperature_1m, center = TRUE, scale = FALSE)
data_2 <- read.csv("Cod_daily_depth_data.csv")
str(data_2)
data_2$date <- dmy(data_2$date)
data_2$log_depth_mean_day <- log(data_2$depth_mean_day)
ggplot(data_2, aes(x = log_depth_mean_day, y = Temperature_1m, color = fish)) +
geom_point() +
geom_line() +
theme_bw() +
labs(title = "Fish abundance by depth and Temperature")
data$Temperature_z <- scale(data_2$Temperature_1m, center = TRUE, scale = FALSE)
data_2$Temperature_z <- scale(data_2$Temperature_1m)
m1 <- lme(fixed = log_depth_day ~ Temperature_z,
data  = data_2,
random = ~ Temperature_z | fish,
method = "REML")    # REML preferred for random effects estimation
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ Temperature_z | fish,
method = "REML")    # REML preferred for random effects estimation
data_clean <- na.omit(data_2[, c("log_depth_mean_day", "Temperature_z", "fish")])
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ Temperature_z | fish,
method = "REML")    # REML preferred for random effects estimation
data_clean <- na.omit(data_2[, c("log_depth_mean_day", "Temperature_z", "fish")])
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_clean,
random = ~ Temperature_z | fish,
method = "REML")    # REML preferred for random effects estimation
summary(m1)
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ Temperature_z | fish,
method = "REML",
na.action = na.omit)    # REML preferred for random effects estimation
summary(m1)
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ fish,
method = "REML",
na.action = na.omit)    # REML preferred for random effects estimation
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ |fish,
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ | fish,
m1 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ 1 | fish,
method = "REML",
na.action = na.omit)    # REML preferred for random effects estimation
summary(m1)
m2 <- lme(fixed = log_depth_mean_day ~ Temperature_z,
data  = data_2,
random = ~ Temperature_z | fish,
method = "REML",
na.action = na.omit)    # REML preferred for random effects estimation
summary(m2)
# Random effects
ranef(m1)    # BLUPs: fish-specific intercepts and slopes
# Variance-covariance of random effects
VarCorr(m1)
# Residual diagnostics
plot(m1)   # residuals vs fitted
qqnorm(residuals(m1, type = "normalized")); qqline(residuals(m1, type = "normalized"))
# Add fitted values and residuals
data_2$fitted <- fitted(m1)                        # fitted values
# Extract the rows actually used in the model
data_used <- data_2[!is.na(data_2$log_depth_mean_day) & !is.na(data_2$Temperature_z), ]
# Add fitted values and residuals
data_used$fitted <- fitted(m1)
data_used$residuals <- residuals(m1, type = "normalized")
# Add fitted values and residuals
data_2$fitted <- fitted(m1)                        # fitted values
# Extract the rows actually used in the model
data_used <- data_2[!is.na(data_2$log_depth_mean_day) & !is.na(data_2$Temperature_z), ]
# Add fitted values and residuals
data_used$fitted <- fitted(m1)
data_used$residuals <- residuals(m1, type = "normalized")
ggplot(data_used, aes(x = fitted, y = residuals, color = fish)) +
geom_point(alpha = 0.6) +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_bw() +
labs(
title = "Residuals vs Fitted Values by Fish",
x = "Fitted log(Dive Depth)",
y = "Normalized Residuals",
color = "Fish ID"
)
acf(residuals(m1, type = "normalized"))
ggplot(data_used, aes(x = date, y = residuals, color = fish)) +
geom_point(alpha = 0.6) +
geom_hline(yintercept = 0, linetype = "dashed") +
theme_bw() +
labs(
title = "Residuals vs Date by Fish",
x = "Date",
y = "Normalized Residuals",
color = "Fish ID"
)
acf(residuals(m1, type = "normalized"))
pacf(residuals(m1, type = "normalized"))
#AR(1) structure
fish_ar1 <- update(m1,
correlation = corAR1(form = ~ date))
acf(residuals(fish_ar1, type = "normalized"))
acf(residuals(fish_ar1, type = "normalized"))
pacf(residuals(fish_ar1 , type = "normalized"))
library(tidyverse)
library(nlme)
library(lme4)
library(sjPlot)
library(ggeffects)
# Population-level predictions (fixed effects only)
pop_pred <- ggpredict(fish_ar1, terms = "Temperature_z")
# Back-transform from log(depth) to depth
pop_pred$predicted_depth <- exp(pop_pred$predicted)
pop_pred$conf.low_depth <- exp(pop_pred$conf.low)
pop_pred$conf.high_depth <- exp(pop_pred$conf.high)
# Population-level predictions (fixed effects only)
pop_pred <- ggpredict(fish_ar1, terms = "Temperature_z")
# Back-transform from log(depth) to depth
pop_pred$predicted_depth <- exp(pop_pred$predicted)
pop_pred$conf.low_depth <- exp(pop_pred$conf.low)
pop_pred$conf.high_depth <- exp(pop_pred$conf.high)
ggplot(pop_pred, aes(x = x, y = predicted_depth)) +
geom_line(color = "blue", size = 1.2) +
geom_ribbon(aes(ymin = conf.low_depth, ymax = conf.high_depth), alpha = 0.2, fill = "blue") +
theme_bw() +
labs(
title = "Population-level predictions of Dive Depth vs Temperature (AR1 model)",
x = "Centered Temperature (Â°C)",
y = "Predicted Dive Depth (m)"
)
